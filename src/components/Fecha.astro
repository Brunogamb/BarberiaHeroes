---
let fechaSeleccionada = "";
---

<section id="fecha" class="turno-section" style="display: none;">
	<div class="container">
		<button class="back-btn">Volver</button>

		<div class="turno-card">
			<h2 class="turno-title">ELEGÍ LA FECHA</h2>

			<div class="calendar">
				<div class="calendar-header">
					<button id="prevMonth" class="calendar-nav">&lt;</button>
					<div id="calTitle" class="calendar-title">Noviembre 2025</div>
					<button id="nextMonth" class="calendar-nav">&gt;</button>
				</div>

				<div class="calendar-weekdays">
					<div>Do</div><div>Lu</div><div>Ma</div><div>Mi</div><div>Ju</div><div>Vi</div><div>Sá</div>
				</div>
				<div id="calendarGrid" class="calendar-grid"></div>
			</div>
		</div>
	</div>
</section>

<style is:global>
    .container {
        max-width: 840px;
        margin: 0 auto;
        padding: 0 20px;
        position: relative;
    }

	.turno-section {
		background: var(--color-bg);
		padding: 40px 0;
	}

	.turno-card {
		background: var(--color-white);
		border-radius: 8px;
		box-shadow: 0 1px 3px var(--color-shadow);
		padding: 24px;
	}

	.turno-title {
		font-size: 1.5rem;
		font-weight: 700;
		color: var(--color-text);
		margin-bottom: 16px;
	}

	.back-btn {
		font-size: 0.9rem;
		background-color: var(--color-accent);
		color: var(--color-white);
		padding: 8px 16px;
		border-radius: 8px;
		font-weight: 500;
		border: none;
		cursor: pointer;
		transition: all 0.3s ease;
		position: absolute;
		left: -80px;
		top: 24px;
	}

	.back-btn:hover {
		opacity: 0.9;
	}

	.calendar {
		width: 100%;
		margin: 0 auto 1.5rem;
		border: 1px solid var(--color-text-light);
		border-radius: 1rem;
		background: var(--color-white);
        text-align: center;
        overflow: hidden;
	}

	.calendar-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: 12px 16px;
		background: var(--color-text-light);
		color: var(--color-white);
	}

	.calendar-title {
		font-weight: 600;
		font-size: 1.2rem;
	}

	.calendar-nav {
		background: rgba(255, 255, 255, 0.15);
		border: none;
		color: var(--color-white);
		padding: 6px 12px;
		font-size: 20px;
		border-radius: 8px;
		cursor: pointer;
		transition: all 0.2s ease;
	}

	.calendar-nav:hover {
		background: rgba(255, 255, 255, 0.25);
	}

	.calendar-weekdays {
		display: grid;
		grid-template-columns: repeat(7, 1fr);
		background: var(--color-white);
		padding: 8px 0;
		font-weight: 600;
		color: var(--color-text);
		font-size: 1.1rem;
		border-bottom: 1px solid var(--color-white);
	}

	.calendar-grid {
		display: grid;
		grid-template-columns: repeat(7, 1fr);
		gap: 6px;
		padding: 12px;
	}

	.calendar-cell {
		height: 60px;
		border-radius: 8px;
		background: var(--color-white);
		border: 1px solid var(--color-text-light);
		display: flex;
		align-items: center;
		justify-content: center;
		font-weight: 500;
		cursor: pointer;
		transition: all 0.15s ease;
	}

	.calendar-cell.empty {
		background: transparent;
		border: none;
		cursor: default;
	}

	.calendar-cell.disabled {
		opacity: 0.4;
		cursor: not-allowed;
		background: var(--color-white);
	}

	.calendar-cell.day:hover:not(.disabled):not(.selected) {
		background: var(--color-text-light);
		color: var(--color-white);
		box-shadow: 0 3px 8px var(--color-shadow);
	}

	.calendar-cell.selected {
		background: var(--color-text-light);
		color: var(--color-white);
		transform: scale(1.03);
	}

	.hidden {
		display: none;
	}
</style>

<script type="module">
document.addEventListener('DOMContentLoaded', () => {
	const grid = document.getElementById('calendarGrid');
	const title = document.getElementById('calTitle');
	const prev = document.getElementById('prevMonth');
	const next = document.getElementById('nextMonth');

	let today = new Date();
	let viewDate = new Date(today.getFullYear(), today.getMonth(), 1);
	let selectedDate = null;

	const monthNames = [
		'Enero','Febrero','Marzo','Abril','Mayo','Junio',
		'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'
	];

	function render() {
		title.textContent = `${monthNames[viewDate.getMonth()]} ${viewDate.getFullYear()}`;
		grid.innerHTML = '';

		const firstDay = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1).getDay();
		const days = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate();

		for (let i = 0; i < firstDay; i++) {
			grid.innerHTML += `<div class="calendar-cell empty"></div>`;
		}

		for (let d = 1; d <= days; d++) {
			const date = new Date(viewDate.getFullYear(), viewDate.getMonth(), d);
			const isPast = date < new Date(today.getFullYear(), today.getMonth(), today.getDate());

			grid.innerHTML += `
				<button class="calendar-cell day${isPast ? ' disabled' : ''}" ${isPast ? 'disabled' : ''}>
					${d}
				</button>`;
		}
	}

	render();

	grid.addEventListener('click', e => {
		if (!e.target.classList.contains('day') || e.target.classList.contains('disabled')) return;

		grid.querySelectorAll('.day').forEach(c => c.classList.remove('selected'));
		e.target.classList.add('selected');

		const year = viewDate.getFullYear();
		const month = String(viewDate.getMonth() + 1).padStart(2, '0');
		const day = String(e.target.textContent.trim()).padStart(2, '0');

		const fechaCompleta = `${day}/${month}/${year}`;

		selectedDate = fechaCompleta;
		localStorage.setItem('fechaSeleccionada', fechaCompleta);

		document.dispatchEvent(new CustomEvent("fechaSeleccionada", { detail: selectedDate }));
	});

	prev.addEventListener('click', () => {
		viewDate.setMonth(viewDate.getMonth() - 1);
		render();
	});

	next.addEventListener('click', () => {
		viewDate.setMonth(viewDate.getMonth() + 1);
		render();
	});
});
</script>